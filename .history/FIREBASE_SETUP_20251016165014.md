# üî• Configuration Firebase - Checklist Compl√®te

## üìã **Services √† Activer dans Firebase Console**

### 1. **Firebase Authentication** ‚úÖ
- Aller dans **Authentication** ‚Üí **Sign-in method**
- Activer **Google** comme fournisseur
- Configurer les domaines autoris√©s

### 2. **Firestore Database** ‚úÖ
- Aller dans **Firestore Database**
- Cr√©er la base de donn√©es en mode **production**
- Choisir la r√©gion **europe-west1** (recommand√©e)
- D√©ployer les r√®gles de s√©curit√©

### 3. **Firebase Storage** ‚úÖ
- Aller dans **Storage**
- Cr√©er un bucket de stockage
- Configurer les r√®gles de s√©curit√©
- Activer les URLs sign√©es

### 4. **Cloud Functions** ‚úÖ
- Aller dans **Functions**
- Activer Cloud Functions (Gen2)
- Configurer la r√©gion **europe-west1**

### 5. **Cloud Tasks** ‚úÖ
- Aller dans **Google Cloud Console**
- Activer l'API Cloud Tasks
- Cr√©er une queue de t√¢ches

## üõ†Ô∏è **Commandes de Configuration**

### Activer les APIs Google Cloud
```bash
# Se connecter √† Google Cloud
gcloud auth login

# S√©lectionner le projet
gcloud config set project lumapost-38e61

# Activer les services requis
gcloud services enable firestore.googleapis.com
gcloud services enable storage.googleapis.com
gcloud services enable cloudfunctions.googleapis.com
gcloud services enable cloudtasks.googleapis.com
gcloud services enable secretmanager.googleapis.com
```

### Cr√©er la queue Cloud Tasks
```bash
# Cr√©er la queue pour la planification
gcloud tasks queues create publish-queue \
  --location=europe-west1 \
  --max-attempts=10 \
  --max-backoff=600s \
  --min-backoff=5s
```

### Cr√©er le service account
```bash
# Cr√©er le service account pour Cloud Tasks
gcloud iam service-accounts create tasks-invoker \
  --display-name="Cloud Tasks Invoker"

# Donner les permissions (apr√®s d√©ploiement des functions)
gcloud run services add-iam-policy-binding publishTikTok \
  --member=serviceAccount:tasks-invoker@lumapost-38e61.iam.gserviceaccount.com \
  --role=roles/run.invoker \
  --region=europe-west1
```

## üîê **Configuration des Secrets**

### Stocker les secrets TikTok
```bash
# Installer Firebase CLI si pas d√©j√† fait
npm install -g firebase-tools

# Se connecter √† Firebase
firebase login

# Initialiser le projet
firebase init

# Stocker les secrets
firebase functions:secrets:set TIKTOK_CLIENT_ID
firebase functions:secrets:set TIKTOK_CLIENT_SECRET
firebase functions:secrets:set ENCRYPTION_KEY
firebase functions:secrets:set BUCKET_NAME
```

## üìù **Variables d'Environnement √† Configurer**

### Dans Firebase Console ‚Üí Project Settings
```env
# Configuration Firebase (√† r√©cup√©rer dans Project Settings)
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyA_W2Clr8riHWOhmhFuxhjRxKMdN9oB8cE
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=lumapost-38e61.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=lumapost-38e61
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=lumapost-38e61.firebasestorage.app
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=939156653935
NEXT_PUBLIC_FIREBASE_APP_ID=1:939156653935:web:9ac1633fd2a8e5b7cb4a9a
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-42VQK97ZK1
```

### Dans Vercel (ou votre plateforme de d√©ploiement)
```env
# Google Cloud Configuration
GCP_PROJECT=lumapost-38e61
GCP_LOCATION=europe-west1
TASK_QUEUE=publish-queue
PUBLISH_ENDPOINT=https://publish-tiktok-xxxxxxxx-ew.a.run.app
TASK_SA=tasks-invoker@lumapost-38e61.iam.gserviceaccount.com
BUCKET_NAME=lumapost-38e61.firebasestorage.app

# TikTok Business API (√† obtenir sur developers.tiktok.com)
TIKTOK_CLIENT_ID=your_tiktok_client_id
TIKTOK_CLIENT_SECRET=your_tiktok_client_secret
TIKTOK_REDIRECT_URI=https://your-domain.com/api/auth/tiktok/callback

# Cl√© de chiffrement (g√©n√©rer une cl√© 32 bytes base64)
ENCRYPTION_KEY=your_32_byte_base64_encryption_key
```

## üöÄ **Ordre de D√©ploiement**

### 1. **D√©ployer les r√®gles Firestore**
```bash
firebase deploy --only firestore:rules
```

### 2. **D√©ployer les r√®gles Storage**
```bash
firebase deploy --only storage:rules
```

### 3. **D√©ployer les Cloud Functions**
```bash
cd functions
yarn install
yarn build
cd ..
firebase deploy --only functions
```

### 4. **D√©ployer l'application Next.js**
```bash
# Sur Vercel
vercel --prod

# Ou sur Firebase Hosting
firebase deploy --only hosting
```

## ‚úÖ **V√©rifications Post-D√©ploiement**

### Dans Firebase Console
- [ ] **Authentication** : Google activ√©
- [ ] **Firestore** : Base de donn√©es cr√©√©e
- [ ] **Storage** : Bucket cr√©√©
- [ ] **Functions** : Fonction `publishTikTok` d√©ploy√©e
- [ ] **R√®gles** : Firestore et Storage s√©curis√©es

### Dans Google Cloud Console
- [ ] **Cloud Tasks** : Queue `publish-queue` cr√©√©e
- [ ] **Service Account** : `tasks-invoker` cr√©√©
- [ ] **Permissions** : Service account a acc√®s aux Functions

### Tests Fonctionnels
- [ ] Connexion Google fonctionne
- [ ] Upload de fichier fonctionne
- [ ] Connexion TikTok fonctionne
- [ ] Planification fonctionne
- [ ] Publication automatique fonctionne

## üö® **Probl√®mes Courants**

### Erreur "auth/invalid-api-key"
- V√©rifier que les cl√©s Firebase sont correctes
- Red√©marrer le serveur de d√©veloppement

### Erreur "Permission denied" Firestore
- V√©rifier les r√®gles Firestore
- S'assurer que l'utilisateur est authentifi√©

### Erreur Cloud Tasks
- V√©rifier que la queue existe
- V√©rifier les permissions du service account
- V√©rifier l'URL de la Cloud Function

## üìû **Support**

Si vous rencontrez des probl√®mes :
1. V√©rifiez les logs Firebase Console
2. V√©rifiez les logs Google Cloud Console
3. Consultez la documentation Firebase
4. Testez avec l'√©mulateur Firebase en local

---

üéØ **Une fois tout configur√©, votre application TikTok Crossposter sera 100% fonctionnelle !**
